---
title: "From Spreadsheets to R - without going too far"
subtitle: "Part 3 - Plotting your data"
output: html_document
editor_options: 
  chunk_output_type: console
---

*This is an R-markdown document. If run in RStudio, you will see code blocks appear with the option to run each one using the little "play button" on the top-right of each block. The output (including errors) will be printed below a block. For the best view, click the `Visual` mode at the top left of this file (if set to Source now)*

Read the [session materials](README.md) for more background on the various functions and their use

## Make sure you have the following libraries loaded

```{r setup, include=FALSE}
library(knitr)
library(readxl)
library(dplyr)
library(ggplot2)
library(stringr)

opts_chunk$set(echo = TRUE)

#install.packages(c("tidyverse", "knitr"))

```

If you get an error that libraries are not installed yet, un-comment the last line (remove the `#`), and run the code block again (you can re-comment once installed).

# Exploring the data

## Read in an Excel file

Let's load in an Excel file derived from a public dataset on water quality measurement. 

https://www.kaggle.com/datasets/shreyanshverma27/water-quality-testing

```{r}
data <- read_xlsx("part3_ggplot/Water_Quality.xlsx")
```

# Mapping dataframe columns to plot aesthetics

We'll put the measure pH level on the x-axis and the amount of dissolved oxygen on the y-axis

```{r}
myPlot <- ggplot(data, aes(x = pH, y = Oxygen))
myPlot
```

*Note that when the plot is rendered, no data points are shown yet because we have not defined the exact type of plot yet*

# Visualising data points - geom\_\*()

Let's start by showing the data as points (i.e. a scatter plot)

```{r}
myPlot + geom_point()
```

We can use the same ggplot object to show the data as a line chart

```{r}
myPlot + geom_line()
```


### Try it yourself

We'll be working with a dataset that comes with R called `iris` which has a record of several plant characteristics for different iris species

```{r}
myData <- iris
glimpse(myData)
```

#### Make a scatter plot (points) of the petal length vs the width

```{r}
myPlot <- ggplot(myData, aes(x = Petal.Length, y = Petal.Width)) + 
  geom_point()
myPlot
```

#### Turn the same plot into a line chart

```{r}
myPlot <- ggplot(myData, aes(x = Petal.Length, y = Petal.Width)) + 
  geom_line()
myPlot
```

*Although it renders, why is this not a good chart type for this data?*

#Static vs data-driven attributes

Depending on the data we have and what we want to visualise, we can have either set some attributes for the whole plot or have them be driven by the data.

## Global / static attribute

Change the size of the points in the plot
```{r}
myPlot <- ggplot(data, aes(x = pH, y = Oxygen)) +
  geom_point(size = 2)
myPlot
```
_Defining an attribute outside of the aes() function in the geom function will set it for all the data points_

## Data driven point size

Change the size based on the water tempature
```{r}
myPlot <- ggplot(data, aes(x = pH, y = Oxygen, size = Temp)) +
  geom_point()
myPlot
```
_Not that the size of the point is now defined by the value of n_actions and a legend appears_

### Try it yourself

#### Continue from the last iris scatter plot and colour all the points blue
```{r}
ggplot(myData, aes(x = Petal.Length, y = Petal.Width)) + 
  geom_point(color = "blue")
```
_You can either provide the name of the colour like "blue" or a hex value like "#1273ed"_

#### Now change this so that each species had a different colour
```{r}
ggplot(myData, aes(x = Petal.Length, y = Petal.Width, colour = Species)) + 
  geom_point()
```
_ggplot will automatically generate colours for different species names_

## Plot layout

### Add axis labels and title
```{r}
myPlot <- ggplot(data, aes(x = pH, y = Oxygen, size = Temp)) +
  geom_point() +
  labs(x = "Water pH", 
       y = "Dissolved Oxygen (mg/L)", 
       title = "Effect of water quality on oxygenation"
       )
myPlot
```
_Add axis labels and a title to the plot_

### Change theme
```{r}
myPlot <- ggplot(data, aes(x = pH, y = Oxygen, size = Temp)) +
  geom_point() +
  labs(x = "Water pH", 
       y = "Dissolved Oxygen (mg/L)", 
       title = "Effect of water quality on oxygenation"
       ) +
  theme_bw()
myPlot
```
_Use a built-in black and white theme_

### Try it yourself

#### Continue from the last iris scatter plot: update the axis labels and add a title

- Title: Iris petal length and width comparison for different species
- x label: Petal length (cm)
- y label: Petal width (cm)
```{r}
ggplot(myData, aes(x = Petal.Length, y = Petal.Width, colour = Species)) + 
  geom_point() + labs(x = "Petal length (cm)", y = "Petal width (cm)", 
                      title = "Iris petal length and width comparison for different species")
```

#### Now add built-in minimal theme to the plot `theme_minimal()` 
```{r}
ggplot(myData, aes(x = Petal.Length, y = Petal.Width, colour = Species)) + 
  geom_point() + labs(
    x = "Petal length", 
    y = "Petal width",
    title = "Iris petal length and width comparison for different species") + theme_minimal()
```

## Bar charts

When creating bar charts with ggplot you have two options depending on the current shape of the data

### Data has already been summarised
```{r}
sumData <- data |>
  group_by(pH) |>
  summarise(Oxygen = mean(Oxygen)) |> 
  ungroup()
```

```{r}
myPlot <- ggplot(sumData, aes(x = pH, y = Oxygen)) +
  geom_bar(stat = "identity")
myPlot
```
_`stat = "identity"` should always be set when you are creating bar charts where you summarised the data per bar already_

## Examples of additional ggplot functions

