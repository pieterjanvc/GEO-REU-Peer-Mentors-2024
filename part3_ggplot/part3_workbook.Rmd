---
title: "From Spreadsheets to R - without going too far"
subtitle: "Part 3 - Plotting your data"
output: html_document
editor_options: 
  chunk_output_type: console
---

*This is an R-markdown document. If run in RStudio, you will see code blocks appear with the option to run each one using the little "play button" on the top-right of each block. The output (including errors) will be printed below a block. For the best view, click the `Visual` mode at the top left of this file (if set to Source now)*

Read the [session materials](README.md) for more background on the various functions and their use

## Make sure you have the following libraries loaded

```{r setup, include=FALSE}
library(knitr)
library(readxl)
library(dplyr)
library(ggplot2)
library(stringr)

opts_chunk$set(echo = TRUE)

#install.packages(c("tidyverse", "knitr"))

```

If you get an error that libraries are not installed yet, un-comment the last line (remove the `#`), and run the code block again (you can re-comment once installed).

# Exploring the data

## Read in an Excel file

Let's load in an Excel file derived from a public dataset on water quality measurement. 

https://www.kaggle.com/datasets/shreyanshverma27/water-quality-testing

```{r}
data <- read_xlsx("part3_ggplot/Water_Quality.xlsx")
```

# Mapping dataframe columns to plot aesthetics

We'll put the measure pH level on the x-axis and the amount of dissolved oxygen on the y-axis

```{r}
myPlot <- ggplot(data, aes(x = pH, y = Oxygen))
myPlot
```

*Note that when the plot is rendered, no data points are shown yet because we have not defined the exact type of plot yet*

# Visualising data points - geom\_\*()

Let's start by showing the data as points (i.e. a scatter plot)

```{r}
myPlot + geom_point()
```

We can use the same ggplot object to show the data as a line chart

```{r}
myPlot + geom_line()
```


### Try it yourself

We'll be working with a dataset that comes with R called `iris` which has a record of several plant characteristics for different iris species

```{r}
myData <- iris
glimpse(myData)
```

#### Make a scatter plot (points) of the petal length vs the width

```{r}
myPlot <- ggplot(myData, aes(x = Petal.Length, y = Petal.Width)) + 
  geom_point()
myPlot
```

#### Turn the same plot into a line chart

```{r}
myPlot <- ggplot(myData, aes(x = Petal.Length, y = Petal.Width)) + 
  geom_line()
myPlot
```

*Although it renders, why is this not a good chart type for this data?*

#Static vs data-driven attributes

Depending on the data we have and what we want to visualise, we can have either set some attributes for the whole plot or have them be driven by the data.

## Global / static attribute

Change the size of the points in the plot
```{r}
myPlot <- ggplot(data, aes(x = pH, y = Oxygen)) +
  geom_point(size = 2)
myPlot
```
_Defining an attribute outside of the aes() function in the geom function will set it for all the data points_

## Data driven point size

Change the size based on the water tempature
```{r}
myPlot <- ggplot(data, aes(x = pH, y = Oxygen, size = Temp)) +
  geom_point()
myPlot
```
_Not that the size of the point is now defined by the value of n_actions and a legend appears_

### Try it yourself

#### Continue from the last iris scatter plot and colour all the points blue
```{r}
ggplot(myData, aes(x = Petal.Length, y = Petal.Width)) + 
  geom_point(color = "blue")
```
_You can either provide the name of the colour like "blue" or a hex value like "#1273ed"_

#### Now change this so that each species had a different colour
```{r}
ggplot(myData, aes(x = Petal.Length, y = Petal.Width, colour = Species)) + 
  geom_point()
```
_ggplot will automatically generate colours for different species names_

## Plot layout

### Add axis labels and title
```{r}
myPlot <- ggplot(data, aes(x = pH, y = Oxygen, size = Temp)) +
  geom_point() +
  labs(x = "Water pH", 
       y = "Dissolved Oxygen (mg/L)", 
       title = "Effect of water pH on oxygenation"
       )
myPlot
```
_Add axis labels and a title to the plot_

### Change theme
```{r}
myPlot <- ggplot(data, aes(x = pH, y = Oxygen, size = Temp)) +
  geom_point() +
  labs(x = "Water pH", 
       y = "Dissolved Oxygen (mg/L)", 
       title = "Effect of water pH on oxygenation"
       ) +
  theme_bw()
myPlot
```
_Use a built-in black and white theme_

### Try it yourself

#### Continue from the last iris scatter plot: update the axis labels and add a title

- Title: Iris petal length and width comparison for different species
- x label: Petal length (cm)
- y label: Petal width (cm)
```{r}
ggplot(myData, aes(x = Petal.Length, y = Petal.Width, colour = Species)) + 
  geom_point() + labs(x = "Petal length (cm)", y = "Petal width (cm)", 
                      title = "Iris petal length and width comparison for different species")
```

#### Now add built-in minimal theme to the plot `theme_minimal()` 
```{r}
ggplot(myData, aes(x = Petal.Length, y = Petal.Width, colour = Species)) + 
  geom_point() + labs(
    x = "Petal length", 
    y = "Petal width",
    title = "Iris petal length and width comparison for different species") + theme_minimal()
```

## Bar charts

When creating bar charts with ggplot you have to summarise the data first

### Data summary
```{r}
sumData <- data |>
  group_by(pH) |>
  summarise(Oxygen = mean(Oxygen)) |> 
  ungroup()
```

### Now plot the bar graph
```{r}
myPlot <- ggplot(sumData, aes(x = pH, y = Oxygen)) +
  geom_bar(stat = "identity")
myPlot
```
_`stat = "identity"` should always be set when you are creating bar charts where you summarised the data per bar already_

### Try it yourself

#### Summarise the iris data so you have the average `mean()` petal length per species

```{r}
sumData <- myData |> 
  group_by(Species) %>% 
  summarise(avgPetalLength = mean(Petal.Length)) %>% 
  ungroup()
```

#### Now create a bat chart with one bar per species and the height representing the average petal length
```{r}
ggplot(sumData, aes(x = Species, y = avgPetalLength)) + 
  geom_bar(stat = "identity")
```

#### How can you make the bars horizontal instead of vertical? 
```{r}
ggplot(sumData, aes(x = avgPetalLength, y = Species)) + 
  geom_bar(stat = "identity")
```

## Saving a plot as an image

Once you are happy with your result, you can save the plot as an image.
```{r}
myPlot <- ggplot(data, aes(x = pH, y = Oxygen, color = Conductivity)) +
  geom_point(size = 2) +
  labs(x = "Water pH", 
       y = "Dissolved Oxygen (mg/L)", 
       title = "Effect of water pH on oxygenation"
       ) +
  theme_bw()
myPlot

ggsave(filename = "oxygenation.png", plot = myPlot, width = 1800, height = 900, units = "px")
```

## Bringing it all together

Let's look at a wine tasting experiment. Experts rated red wines on a ten point scale. In addition specific wine properties were measured. Let's evlaute some of the result visually.

https://www.kaggle.com/datasets/shilongzhuang/red-and-white-wine-quality

#### Load the `winequality-red.csv` dataset using the built-in `read.csv()` function into a new variable called `wine`.

```{r}
wine <- read.csv("part3_ggplot/winequality-red.csv")
```
_Note that this data is not stored as an XLSX file but a CSV file_

#### Create a plot with the following properties:

- scatter plot
- fixed acidity on x axis
- density on y axis
- alcohol is represented as the point colour
- all points are of size 1.2
- title: Correlation between acidity and density in red wines
- use the built-in light theme

```{r}

winePlot <- ggplot(wine, aes(x = fixed.acidity, y = density, colour = alcohol)) + 
  geom_point(size = 1.2) + theme_light()

```

#### Now summarise the data so that you get the average `mean()` sulphates concentration per quality level and save this to a new varliable `sulQual`
```{r}

sulQual <- myData %>% 
  group_by(quality) %>% 
  summarise(sulphates = mean(sulphates)) %>% 
  ungroup()

```

#### Create a barchar of the results and style the plot as you see fit
```{r}
sulQualPlot <- ggplot(sulQual, aes(x = quality, y = sulphates)) + 
  geom_bar(stat = "identity")
sulQualPlot
```

#### Save the barchart as a PNG image `wine_sulfate_quality.png` with dimensions 550px x 1150px (width x height)

```{r}
ggsave(filename = "wine_sulfate_quality.png",plot =sulQualPlot, width = 550, height = 1150, units = "px")
```



